# 要件定義: Admin UI刷新 (Mantine v8導入)

## 概要

- **対象**: `apps/admin` (管理者用データベース管理アプリ)
- **参照元**: [`docs/20260227-admin-update-plan.md`](../20260227-admin-update-plan.md)
- **作成日**: 2026-02-26

---

## ユーザーストーリー

### US-1: 開発者として、Mantineコンポーネントを使って管理UIを実装したい

管理者として一貫したUIコンポーネントで素早くデータを編集できるようにするため、開発者はMantine v8をadminアプリに導入し、既存の素のHTMLコンポーネントをMantineに置き換えたい。

### US-2: 管理者として、ローディング状態を視覚的に確認したい

DBとの通信状況をリアルタイムで把握できるよう、登録中の待機表示、スケルトンUI、ローディングスピナーを確認したい。

### US-3: 管理者として、lines・operators・stationsの基本情報をadminから編集したい

現在adminから編集できないリソース（lines全体、operators全体、stationsのよみがな以外の基本情報）のページから直接編集したい。

### US-4: 管理者として、未解決路線にGeminiのAI提案を活用したい

ODPTのIDから日本語名と路線コードをAIに推測させ、入力作業を効率化したい。

### US-5: 管理者として、日本語で統一されたUIを利用したい

現在英語と日本語が混在しているUIを日本語に統一したい。

### US-6: 管理者として、スマートフォンでもadminを操作したい

外出先でもスマートフォンからデータを確認・編集できるよう、レスポンシブデザインに対応してほしい。

---

## EARS記法による機能要件

### カテゴリ1: Mantine導入・共通基盤

**REQ-1.1** Mantineをインストールしたとき、システムはadminアプリ全体でMantineのコンポーネントが利用可能であること

**REQ-1.2** アプリケーション初期化のとき、システムはMantineProviderをレイアウトのルートに設定し、テーマを一貫して適用すること

**REQ-1.3** ダークモード設定が変更されたとき、システムはMantineのカラースキームに基づいて全UIを切り替えること（任意: 将来拡張用）

### カテゴリ2: 既存コンポーネントのMantine移行

**REQ-2.1** ページ遷移のとき、システムはMantineのAppShellコンポーネントでナビゲーション（Sidebar）を表示すること

**REQ-2.2** フォームを送信するとき、システムはMantineのButtonコンポーネント（loading状態付き）を表示すること

**REQ-2.3** ドロップダウン選択肢が存在するとき、システムはMantineのSelect/NativeSelectコンポーネントを使用すること

**REQ-2.4** テキスト入力が必要なとき、システムはMantineのTextInput/Textareaコンポーネントを使用すること

**REQ-2.5** 数値入力が必要なとき、システムはMantineのNumberInputコンポーネントを使用すること

**REQ-2.6** チェックボックスが必要なとき、システムはMantineのCheckbox/Checkbox.Groupコンポーネントを使用すること

**REQ-2.7** データ一覧を表示するとき、システムはMantineのTableコンポーネントを使用すること

**REQ-2.8** 削除操作を実行するとき、システムはMantineのModalで確認ダイアログを表示すること（現在のalert()からの移行）

**REQ-2.9** バリデーションエラーが発生したとき、システムはMantineのAlert/Notificationでエラーを表示すること

### カテゴリ3: ローディング状態

**REQ-3.1** ページ初期ロードのとき、システムはMantineのSkeletonコンポーネントでコンテンツのプレースホルダーを表示すること

**REQ-3.2** ドロップダウンの選択肢を非同期取得するとき、システムはローディングスピナーを表示すること

**REQ-3.3** フォームを送信中のとき、システムはボタンにローディングインジケーターを表示し、二重送信を防止すること

**REQ-3.4** データ取得が失敗したとき、システムはエラーメッセージと再試行ボタンを表示すること

### カテゴリ4: 新規ページ（Lines・Operators・Stations基本情報）

**REQ-4.1** `/operators` にアクセスしたとき、システムはオペレーター一覧を表示し、追加・編集・削除を可能にすること

**REQ-4.2** `/lines` にアクセスしたとき、システムは路線一覧を表示し、ODPTコード・名称・オペレーター等の基本情報を編集可能にすること

**REQ-4.3** `/stations/[stationId]/edit` にアクセスしたとき、システムはよみがなに加えて駅コード・駅名・オペレーター等の基本情報すべてを編集可能にすること

### カテゴリ5: Gemini AI連携（未解決路線）

**REQ-5.1** 未解決路線のODPT IDが存在するとき、システムはGemini APIに問い合わせて日本語名と路線コードの候補を提示すること

**REQ-5.2** AI提案を受け取ったとき、システムは管理者が確認・修正してから保存できるフォームを提供すること

**REQ-5.3** Gemini APIが利用不可のとき、システムは手動入力にフォールバックし、エラーを表示すること

### カテゴリ6: 日本語UI統一

**REQ-6.1** すべての画面において、システムはラベル・ボタン・プレースホルダー・エラーメッセージを日本語で表示すること

**REQ-6.2** 確認ダイアログが必要なとき、システムは日本語のメッセージを表示すること

### カテゴリ7: レスポンシブデザイン

**REQ-7.1** スマートフォン（幅375px以上）でアクセスしたとき、システムはナビゲーションをハンバーガーメニューに切り替え、コンテンツを縦レイアウトで表示すること

**REQ-7.2** タブレット（幅768px以上）でアクセスしたとき、システムはサイドバーを折りたたみ可能な形式で表示すること

**REQ-7.3** フォームコンポーネントが存在するとき、システムはすべての入力フィールドをタッチ操作に対応したサイズで表示すること

---

## 非機能要件

**NFR-1**: Mantineコンポーネントの採用により、新規UIコンポーネントの実装コストを既存比50%以上削減すること

**NFR-2**: 既存の認証（NextAuth.js v5）・DB接続（DrizzleORM）・APIルートへの影響を最小化すること

**NFR-3**: TypeScript型安全性を維持し、`any`型の使用を禁止すること

**NFR-4**: `console.log`をコミットしないこと

---

## 優先度・範囲

| 優先度 | カテゴリ | 備考 |
|--------|---------|------|
| P0（必須） | Mantine導入・共通基盤 (REQ-1.x) | 他すべての前提 |
| P0（必須） | 既存コンポーネント移行 (REQ-2.x) | UI刷新の核心 |
| P1（高） | ローディング状態 (REQ-3.x) | UX改善 |
| P1（高） | 日本語UI統一 (REQ-6.x) | 並行して実施 |
| P1（高） | 新規ページ (REQ-4.x) | 運用上の必須要件 |
| P2（中） | レスポンシブデザイン (REQ-7.x) | モバイル対応 |
| P3（低） | Gemini AI連携 (REQ-5.x) | 将来拡張 |

---

## 信頼度スコア

**信頼度: 88%（高）**

**根拠:**
- 現行コードの全コンポーネント・ページ構成を把握済み
- Mantine v8のAPIはwebアプリでの導入事例あり
- 移行対象のコンポーネント数・複雑度が明確
- Gemini API連携は外部APIのため不確実性が残る（→ P3に降格）
- DBスキーマの変更は不要と判断（既存APIを流用）

→ **高信頼度（>85%）**: 包括的な段階的実装計画を策定し、PoC不要で実装を進める。
